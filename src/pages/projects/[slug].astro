---
import { getCollection } from 'astro:content';
import Base from '@/layouts/Base.astro';
import type { SiteMeta } from '@/types';
import type { CollectionEntry } from 'astro:content';

export async function getStaticPaths() {
  const projects = await getCollection('projects', ({ data }) => {
    return data.draft !== true;
  });
  return projects.map(project => ({
    params: { slug: project.id },
    props: { project },
  }));
}

interface Props {
  project: CollectionEntry<'projects'>;
}

const { project } = Astro.props;

const meta: SiteMeta = {
  title: project.data.title,
  description: project.data.shortDescription,
  articleDate: undefined,
  ogImage: project.data.imageUrls && project.data.imageUrls.length > 0 ? project.data.imageUrls[0] : undefined,
};
---

<Base meta={meta}>
  <style>
    .project-detail-container {
      padding: 2rem 0;
    }
    .project-header {
      text-align: center;
      margin-bottom: 2rem;
    }
    .project-header h1 {
      font-size: 2.5rem; /* text-4xl */
      font-weight: 700; /* font-bold */
      margin-bottom: 0.5rem;
    }
    .project-header .company {
      font-size: 1.125rem; /* text-lg */
      color: #718096; /* gray-600 */
      margin-bottom: 0.25rem;
    }
    .project-header .year {
      font-size: 1rem; /* text-base */
      color: #a0aec0; /* gray-500 */
      margin-bottom: 1.5rem;
    }
    .project-images {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 1rem;
      margin-bottom: 2rem;
    }
    .project-images img {
      width: 100%;
      height: auto;
      border-radius: 0.375rem; /* rounded-md */
      box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1), 0 2px 4px -1px rgba(0,0,0,0.06); /* shadow-md */
    }
    .project-content {
      line-height: 1.7;
      font-size: 1.125rem; /* text-lg */
    }
    .project-content h2 {
      font-size: 1.875rem; /* text-2xl */
      font-weight: 600; /* font-semibold */
      margin-top: 2rem;
      margin-bottom: 1rem;
      border-bottom: 1px solid #e2e8f0; /* gray-300 */
      padding-bottom: 0.5rem;
    }
    .project-content h3 {
      font-size: 1.5rem; /* text-xl */
      font-weight: 600; /* font-semibold */
      margin-top: 1.5rem;
      margin-bottom: 0.75rem;
    }
    .project-content p {
      margin-bottom: 1rem;
    }
    .project-content ul {
      list-style: disc;
      margin-left: 1.5rem;
      margin-bottom: 1rem;
    }
    .project-content li {
      margin-bottom: 0.5rem;
    }
    .project-links {
      margin-top: 2rem;
      padding-top: 1rem;
      border-top: 1px solid #e2e8f0; /* gray-300 */
    }
    .project-links a {
      display: inline-block;
      margin-right: 1rem;
      color: #2b6cb0; /* blue-600 */
      text-decoration: none;
      padding: 0.5rem 1rem;
      border: 1px solid #2b6cb0; /* blue-600 */
      border-radius: 0.375rem; /* rounded-md */
      transition: background-color 0.2s, color 0.2s;
    }
    .project-links a:hover {
      background-color: #2b6cb0; /* blue-600 */
      color: white;
    }
    .tech-tags {
      margin-top: 1.5rem;
      margin-bottom: 1.5rem;
    }
    .tech-tag {
      display: inline-block;
      background-color: #edf2f7; /* gray-200 */
      color: #4a5568; /* gray-700 */
      padding: 0.25rem 0.75rem;
      border-radius: 9999px; /* rounded-full */
      font-size: 0.875rem; /* text-sm */
      margin-right: 0.5rem;
      margin-bottom: 0.5rem;
    }
  </style>

  <article class="project-detail-container">
    <header class="project-header">
      <h1>{project.data.title}</h1>
      {project.data.clientOrCompany && <p class="company">Client/Company: {project.data.clientOrCompany}</p>}
      <p class="year">Year: {project.data.displayYear}</p>
    </header>

    {project.data.imageUrls && project.data.imageUrls.length > 0 && (
      <section class="project-images">
        {project.data.imageUrls.map(imageUrl => (
          <img src={imageUrl} alt={project.data.title + " image"} />
        ))}
      </section>
    )}

    <section class="project-content prose prose-lg max-w-none dark:prose-invert">
      <div set:html={project.body} />
    </section>

    {project.data.technologies && project.data.technologies.length > 0 && (
      <section class="tech-tags">
        <strong>Technologies Used:</strong>
        <div>
          {project.data.technologies.map(tech => (
            <span class="tech-tag">{tech}</span>
          ))}
        </div>
      </section>
    )}

    <nav class="project-links">
      {project.data.contraLink && <a href={project.data.contraLink} target="_blank" rel="noopener noreferrer">View on Contra</a>}
      {project.data.projectUrl && <a href={project.data.projectUrl} target="_blank" rel="noopener noreferrer">View Project Site</a>}
      <a href="/projects">Back to All Projects</a>
    </nav>
  </article>
</Base> 