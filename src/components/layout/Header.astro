---
import Search from "@/components/Search.astro";
import ThemeToggle from "@/components/ThemeToggle.astro";
import { siteConfig, menuLinks } from "@/site.config";
import { Icon } from "astro-icon/components";
// Removed: import { Image } from 'astro:assets';
// Removed: import siteIcon from '@/assets/images/icon.svg';
---

<header
	id="main-header"
	class="fixed px-4 md:px-0 left-0 z-20 flex items-center md:relative top-0 h-16 w-full bg-bgColor md:bg-transparent overflow-hidden"
>	
	<!-- Background 
			TODO: This approach is not optimal and requires improvements. 
  			- Too many absolutely positioned elements can affect performance. 
  		-->	
	<div class="md:hidden absolute top-0 left-1/2 -ml-[50vw] w-screen min-h-screen pointer-events-none blur-2xl">
		<div class="absolute top-[-90%] right-[25%] w-[75%] h-full bg-gradient-to-b from-blue-300 via-pink-300 to-transparent rounded-full opacity-40 dark:opacity-5"></div>
		<div class="absolute top-[-90%] left-[25%] w-[75%] h-full bg-gradient-to-b from-blue-300 via-pink-300 to-transparent rounded-full opacity-40 dark:opacity-5"></div>
		<div class="absolute top-[-85%] right-[25%] w-[55%] h-full bg-gradient-to-b from-purple-300 via-blue-300 to-transparent rounded-full opacity-40 dark:opacity-5"></div>
		<div class="absolute top-[-85%] left-[25%] w-[55%] h-full bg-gradient-to-b from-indigo-300 via-orange-300 to-transparent rounded-full opacity-40 dark:opacity-5"></div>
		<div class="absolute top-[-75%] left-[-25%] w-[65%] h-full bg-gradient-to-b from-blue-300 via-pink-300 to-transparent rounded-full opacity-30 dark:opacity-5"></div>
		<div class="absolute top-[-75%] right-[-25%] w-[65%] h-full bg-gradient-to-b from-purple-300 via-blue-300 to-transparent rounded-full opacity-30 dark:opacity-5"></div>
		<div class="absolute top-[-85%] left-[-30%] w-[85%] h-full bg-gradient-to-b from-indigo-300 via-orange-300 to-transparent rounded-full opacity-60 dark:opacity-5"></div>
		<div class="absolute top-[-85%] right-[-30%] w-[85%] h-full bg-gradient-to-b from-orange-300 via-indigo-300 to-transparent rounded-full opacity-60 dark:opacity-5"></div>
	</div>
	
	<div class="w-full justify-between sm:flex-col">
		<div class="flex items-center gap-x-2">
			<a
				aria-label={siteConfig.title}
				aria-current={Astro.url.pathname === "/" ? "page" : false}
				class="group flex h-8 items-center hover:filter-none sm:relative"
				href="/"
			>	
				<!-- Logo -->
				<!--
				<div class="pt-1.5">
					<svg class="inline-block size-8 fill-current text-accent-base drop-shadow-[0px_2.5px_2.5px_rgba(0,0,0,0.35)]">
						<use href="/brand.svg#brand"></use>
					</svg>
				</div>
				-->
				<div title={siteConfig.title}>
					{/* <Image src={siteIcon} alt={siteConfig.title} class="inline-block size-8 drop-shadow-[0px_2.5px_2.5px_rgba(0,0,0,0.35)]" /> */}
					<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 500 500" class="inline-block size-8 drop-shadow-[0px_2.5px_2.5px_rgba(0,0,0,0.35)]">
						<defs>
							<linearGradient id="gradient_0_icon" gradientUnits="userSpaceOnUse" x1="154.46902" y1="214.42609" x2="266.38486" y2="214.52754">
								<stop offset="0" stop-color="#014CAF"/>
								<stop offset="1" stop-color="#876DD5"/>
							</linearGradient>
							<linearGradient id="gradient_1_icon" gradientUnits="userSpaceOnUse" x1="279.76608" y1="307.63589" x2="344.74915" y2="307.60699">
								<stop offset="0" stop-color="#9672D9"/>
								<stop offset="1" stop-color="#E384ED"/>
							</linearGradient>
						</defs>
						<path fill="url(#gradient_0_icon)" d="M216.252 338.6C218.873 337.688 220.957 336.344 222.977 334.442C225.929 331.662 227.705 328.577 228.964 324.745C233.91 309.684 233.176 281.419 232.71 265.141C232.43 255.386 232.145 245.675 231.175 235.958C229.745 221.642 226.917 207.492 225.79 193.144C224.589 177.855 224.345 162.594 223.734 147.285C223.25 135.174 222.244 122.848 222.563 110.737C222.763 103.114 223.505 95.0448 229.389 89.5365C237.299 82.1308 251.365 82.2922 261.514 82.742C265.143 82.9028 268.24 83.9781 270.732 86.684C269.063 86.458 267.881 84.0896 266.299 84.9733C266.239 85.5844 266.22 85.244 266.381 85.8615C266.642 86.8636 266.065 94.71 265.685 95.6107C263.872 93.3533 261.631 92.0032 258.788 91.4253C252.198 90.086 243.429 91.3255 237.784 95.1249C235.725 96.511 234.012 98.2169 233.261 100.649C230.829 108.53 231.669 142.482 232.428 152.404C232.991 159.773 234.227 167.09 234.581 174.461C234.76 178.205 234.512 181.99 234.481 185.738C234.438 190.874 234.66 195.889 235.165 201.002C236.003 209.482 237.562 217.935 238.742 226.377C239.736 233.538 240.45 240.734 240.881 247.95C241.993 264.933 241.864 283.468 241.213 300.468C240.971 306.781 241.072 313.495 239.816 319.699C238.025 328.546 234.103 337.393 226.376 342.451C223.429 344.38 218.427 347.266 214.81 346.417C212.15 345.792 209.668 344.265 207.445 342.732C201.003 338.293 195.879 332.683 193.113 325.281C191.505 320.979 190.219 316.085 189.574 311.534C187.745 298.632 188.135 285.316 188.126 272.311C188.099 248.595 188.566 224.881 189.529 201.185C189.786 192.878 191.441 175.62 187.22 168.779C185.716 166.342 183.389 164.892 180.632 164.247C177.508 163.517 171.291 161.763 168.505 163.601C166.269 165.077 164.764 168.651 164.188 171.21C161.736 182.109 163.196 213.231 164.197 225.105C164.638 230.328 166.7 239.872 165.519 244.729C165.237 245.887 164.704 246.828 163.645 247.43C162.481 248.092 161.049 248.037 159.807 247.639C158.729 247.293 158.288 246.646 157.822 245.667C156.333 242.543 156.448 236.908 156.15 233.363C154.944 220.073 154.279 206.739 154.156 193.394C154.111 188.015 153.991 182.584 154.371 177.216C154.644 173.37 155.249 169.613 156.619 165.993C158.245 161.695 160.693 157.488 165.07 155.561C170.229 153.29 177.115 152.916 182.388 154.973C191.314 158.456 195.47 163.496 198.104 172.615C200.751 181.777 199.151 196.392 198.823 206.181C198.032 225.818 197.508 245.465 197.25 265.117C197.103 274.016 197.164 282.85 197.395 291.749C197.549 297.665 197.65 303.742 198.449 309.611C198.989 313.583 199.97 317.735 201.58 321.406C204.201 327.382 209.955 336.116 216.252 338.6Z"/>
						<path fill="url(#gradient_1_icon)" d="M279.122 269.699L279.582 269.857C280.106 268.632 280.566 267.344 280.866 266.042C281.105 265.007 281.402 263.883 280.804 262.922C280.575 263.286 280.448 263.456 280.108 263.737C278.646 262.797 280.529 258.637 280.82 257.403C281.081 256.297 280.884 255.11 281.12 253.97C281.418 252.529 282.317 251.028 282.277 249.547C282.249 248.532 281.203 247.972 281.089 246.983C280.933 245.627 281.843 245.176 282.444 244.133C283.102 242.993 282.376 241.181 281.939 240.042C281.143 237.964 282.197 236.788 281.879 235.225C281.744 234.566 280.657 233.222 280.268 232.584C280.312 232.526 280.594 232.146 280.641 232.1C280.813 231.93 280.992 231.781 281.159 231.587C281.081 230.721 280.941 230.623 280.419 229.965C280.364 228.314 281.152 226.694 281.201 225.003C281.269 222.704 280.492 219.531 281.288 217.395C281.645 217.699 281.736 217.803 282.21 217.894C282.725 216.759 282.493 215.01 282.452 213.766C282.219 214.035 282.144 214.742 282.055 215.103C281.987 214.83 281.964 214.791 281.956 214.466C281.912 212.855 282.443 210.971 282.611 209.341C282.836 207.153 282.341 201.548 283.605 200.031L283.799 200.258C283.938 200.868 284.011 201.297 283.931 201.921C283.871 202.392 283.855 202.786 283.903 203.263L284.195 203.248C284.732 202.18 284.457 200.751 284.541 199.56L284.864 199.313L285.555 200.336C285.968 202.869 286.015 205.627 286.051 208.198C286.506 211.288 286.147 214.462 286.415 217.579C286.456 224.427 286.406 231.275 286.265 238.122C286.209 241.192 286.381 244.594 286.034 247.629C286.506 251.174 286.066 254.772 286.432 258.331C286.608 268.88 287.467 279.407 289.003 289.845C289.928 296.354 291.204 302.811 292.084 309.325C292.49 312.339 292.97 315.434 293.165 318.466C293.56 324.627 293.427 330.761 294.154 336.907C294.972 343.825 297.066 350.488 298.002 357.373C299.059 365.144 297.718 373.104 299.438 380.81C301.321 389.241 304.986 400.502 311.225 406.633C313.262 408.635 316.55 408.752 319.247 408.651C323.54 408.49 327.327 406.593 330.226 403.455C333.01 400.442 334.483 397.141 335.197 393.118C335.728 390.126 335.516 387.054 335.535 384.028C335.554 381.032 335.678 378.045 335.788 375.052C336.144 362.224 336.328 349.391 336.34 336.558C336.437 324.592 336.701 312.46 336.146 300.506C335.952 296.333 334.501 292.45 334.154 288.351C333.61 281.923 334.625 275.443 333.457 269.043C332.151 261.893 328.754 255.236 327.68 248.062C327.055 243.881 327.615 239.799 327.502 235.628C326.312 233.958 325.182 232.547 325.506 230.364C325.696 229.08 326.463 227.928 327.537 227.212C328.528 226.551 329.733 226.287 330.905 226.529C332.512 226.862 333.795 228.114 334.599 229.491C338.205 235.672 336.412 243.269 337.456 249.994C338.351 255.763 340.908 261.337 342.471 266.963C343.319 270.018 343.625 273.357 344.004 276.501C344.754 282.721 344.776 289.24 345.02 295.5C345.736 313.915 345.483 332.368 345.485 350.794L345.458 374.799C345.424 381.524 345.934 390.79 344.094 397.209C341.936 404.733 337.164 410.599 330.314 414.329C323.498 418.039 316.799 417.905 309.508 415.708C304.73 414.267 302.011 409.106 299.863 404.978C295.858 397.284 292.654 388.784 291.059 380.243C289.911 374.092 290.233 367.965 290.156 361.751C290.084 357.929 289.839 354.112 289.423 350.312C287.617 332.829 284.971 315.41 282.624 297.993C281.355 288.583 280.479 279.087 279.122 269.699Z"/>
						<path fill="#9270D7" d="M286.034 247.629C286.506 251.174 286.066 254.772 286.432 258.331C285.89 257.569 285.658 256.711 285.163 255.916C284.372 254.645 285.517 252.219 285.749 250.881C285.934 249.819 285.967 248.705 286.034 247.629Z"/>
						<path fill="#9270D7" d="M286.051 208.198C286.506 211.288 286.147 214.462 286.415 217.579C286.196 217.259 285.988 216.964 285.85 216.597C284.345 212.591 285.562 212.028 286.051 208.198Z"/>
						<path fill="#9270D7" d="M280.175 274.098C280.452 274.343 280.707 274.57 280.878 274.906C281.423 275.976 281.208 276.988 280.86 278.076C280.874 276.53 279.961 275.641 280.175 274.098Z"/>
						<path fill="#9270D7" d="M265.685 95.6107C266.065 94.71 266.642 86.8636 266.381 85.8615C266.22 85.244 266.239 85.5844 266.299 84.9733C267.881 84.0896 269.063 86.458 270.732 86.684C277.837 92.8311 279.31 101.784 279.943 110.568C280.801 122.482 279.867 134.375 280.569 146.268C281.634 164.335 284.308 182.275 285.555 200.336L284.864 199.313L284.541 199.56C284.457 200.751 284.732 202.18 284.195 203.248L283.903 203.263C283.855 202.786 283.871 202.392 283.931 201.921C284.011 201.297 283.938 200.868 283.799 200.258L283.605 200.031C282.341 201.548 282.836 207.153 282.611 209.341C282.443 210.971 281.912 212.855 281.956 214.466C281.964 214.791 281.987 214.83 282.055 215.103C282.144 214.742 282.219 214.035 282.452 213.766C282.493 215.01 282.725 216.759 282.21 217.894C281.736 217.803 281.645 217.699 281.288 217.395C280.492 219.531 281.269 222.704 281.201 225.003C281.152 226.694 280.364 228.314 280.419 229.965C280.941 230.623 281.081 230.721 281.159 231.587C280.992 231.781 280.813 231.93 280.641 232.1C280.594 232.146 280.312 232.526 280.268 232.584C280.657 233.222 281.744 234.566 281.879 235.225C282.197 236.788 281.143 237.964 281.939 240.042C282.376 241.181 283.102 242.993 282.444 244.133C281.843 245.176 280.933 245.627 281.089 246.983C281.203 247.972 282.249 248.532 282.277 249.547C282.317 251.028 281.418 252.529 281.12 253.97C280.884 255.11 281.081 256.297 280.82 257.403C280.529 258.637 278.646 262.797 280.108 263.737C280.448 263.456 280.575 263.286 280.804 262.922C281.402 263.883 281.105 265.007 280.866 266.042C280.566 267.344 280.106 268.632 279.582 269.857L279.122 269.699C278.225 260.958 277.565 252.052 277.573 243.262C277.581 234.472 278.169 225.747 277.809 216.952C276.85 193.498 273.544 170.184 271.787 146.789C271.543 143.542 271.269 140.269 271.243 137.013C271.182 129.369 271.672 121.542 270.711 113.943C269.927 107.739 269.304 100.887 265.685 95.6107Z"/>
					</svg>
				</div>
				
				<strong class="bg-clip-text text-transparent bg-gradient-to-r from-accent-one to-accent-two hidden xs:block z-10 mb-0.5 ms-2 text-sm sm:text-xl md:text-2xl group-hover:text-accent-one">
					<span class="sm:hidden">Juan</span>
					<span class="hidden sm:inline">{siteConfig.title}</span>
				</strong>
			</a>
			<nav
				aria-label="Main menu"
				class="top-20 text-sm mx-auto ml-4 ml-auto hidden flex-col items-end justify-center gap-x-4 rounded-md bg-bgColor font-medium text-accent-two shadow backdrop-blur group-[.menu-open]:z-50 group-[.menu-open]:flex sm:static sm:z-auto sm:flex-row sm:items-center sm:rounded-none sm:bg-transparent sm:shadow-none sm:backdrop-blur-none md:flex"
				id="main-navigation-menu"
			>	
				<!--				
				<a
					aria-current={Astro.url.pathname === "/" ? "page" : false}
					class="flex gap-x-1 h-8 items-center justify-center rounded-lg underline-offset-2 hover:underline"
					href="/"
				>	
					<Icon
						class="size-4 drop-shadow-[0px_1.5px_1.5px_rgba(0,0,0,0.175)]"
						name="solar:home-2-bold"
					/>
					Home
				</a>
				<a
					aria-current={Astro.url.pathname === "/" ? "page" : false}
					class="flex gap-x-1 h-8 items-center justify-center rounded-lg underline-offset-2 hover:underline"
					href="/"
				>	
					<Icon
						class="size-4 drop-shadow-[0px_1.5px_1.5px_rgba(0,0,0,0.175)]"
						name="solar:archive-bold"
					/>
					Blog
				</a>
				-->

				<!-- Menu links -->
				{
					menuLinks.map((link) => (
						<a
							aria-current={Astro.url.pathname === link.path ? "page" : false}
							class="underline-offset-2 hover:underline"
							data-astro-prefetch
							href={link.path}
						>
							{link.title}
						</a>
					))
				}
				
				<!-- Dropdown menu button for large screens. Needs improvement. -->
				<!--
				<button
					aria-expanded="false"
					aria-haspopup="menu"
					aria-label="Open main menu"
					class="hidden md:flex group text-sm relative h-8 w-16 font-medium items-center justify-center px-4 rounded-lg bg-accent-base/5 text-accent-base hover:bg-accent-base/10"
					id="toggle-navigation-menu"
					type="button"
				>
					Menu
				</button>
				-->
			</nav>
			
			<!-- Dropdown menu for large screens. Needs improvement. -->
			<!--
			<div id="menu" class="absolute left-0 right-0 w-fit ml-auto top-16 z-10 hidden" aria-hidden="true">
				<div
					id="menu-body"
					class="fixed bg-bgColor rounded-lg -ml-56 w-56"
				>
					<nav
						aria-label="Main menu"
						class="px-4 py-4 rounded-lg border border-special-lighter bg-special-light shadow-[0px_10px_25px_rgba(0,0,0,0.15)] text-sm flex flex-col gap-y-2 font-medium"
						id="main-navigation-menu"
					>
						{
							menuLinks.map((link) => (
								<a
									aria-current={Astro.url.pathname === link.path ? "page" : false}
									class="text-accent-two underline-offset-2 hover:underline rounded-lg h-8 gap-x-1 px-2 flex justify-center items-center"
									data-astro-prefetch
									href={link.path}
								>
									{link.title}
								</a>
							))
						}
						{/* <a
							class="flex h-8 items-center justify-center rounded-lg bg-accent-base/5 hover:bg-accent-base/10 px-4 text-accent-base"
							data-astro-prefetch
							href="/posts/citrus-docs/intro/"
						>
							Docs
						</a> */}
					</nav>
				</div>
			</div>
			-->

			<div class="ml-auto w-fit">
				<div id="buttons-panel" class="top-4 md:top-8 -ml-[4.5rem] flex space-x-2">
					<Search />
					<ThemeToggle />
				</div>
			</div>	
			
			<mobile-button
				aria-expanded="false"
				aria-haspopup="menu"
				aria-label="Open main menu"
				class="group relative h-8 w-8 rounded-lg bg-color-100 hover:bg-accent-base/10 text-accent-base md:invisible md:hidden"
				id="toggle-nav-menu-mobile"
				type="button"
			>
				<Icon
					id="open-nav-menu-icon"
					aria-hidden="true"
					class="absolute start-1/2 top-1/2 h-6 w-6 -translate-x-1/2 -translate-y-1/2 scale-100 opacity-100 transition-all"
					focusable="false"
					name="hugeicons:menu-01"
				/>
				<Icon
					id="close-nav-menu-icon"
					aria-hidden="true"
					class="absolute start-1/2 top-1/2 h-6 w-6 -translate-x-1/2 -translate-y-1/2 scale-0 opacity-0 transition-all"
					focusable="false"
					name="hugeicons:cancel-01"
				/>
			</mobile-button>
		</div>
	</div>
</header>

<div id="drawer" class="fixed inset-0 z-10 hidden" aria-hidden="true">
	<div
		id="drawer-body"
		class="absolute inset-0 -translate-y-full transform bg-bgColor transition-all duration-300 ease-in-out"
	>
		<!-- Background 
			TODO: This approach is not optimal and requires improvements. 
  			- Too many absolutely positioned elements can affect performance. 
  		-->		
		<div class="fixed top-0 left-1/2 -ml-[50vw] w-screen pointer-events-none min-h-screen overflow-x-hidden overflow-y-visible blur-2xl">
				<!--
				<div class="fixed blur-xl top-0 left-0 w-full h-16 md:h-20 bg-gradient-to-b from-indigo-300 via-purple-300 to-transparent opacity-10 dark:opacity-5"></div>
				-->
				<div class="absolute top-[-90%] right-[25%] w-[75%] h-full bg-gradient-to-b from-blue-300 via-pink-300 to-transparent rounded-full opacity-40 dark:opacity-5"></div>
				<div class="absolute top-[-90%] left-[25%] w-[75%] h-full bg-gradient-to-b from-blue-300 via-pink-300 to-transparent rounded-full opacity-40 dark:opacity-5"></div>
				<div class="absolute top-[-85%] right-[25%] w-[55%] h-full bg-gradient-to-b from-purple-300 via-blue-300 to-transparent rounded-full opacity-40 dark:opacity-5"></div>
				<div class="absolute top-[-85%] left-[25%] w-[55%] h-full bg-gradient-to-b from-indigo-300 via-orange-300 to-transparent rounded-full opacity-40 dark:opacity-5"></div>
				<div class="absolute top-[-75%] left-[-25%] w-[65%] h-full bg-gradient-to-b from-blue-300 via-pink-300 to-transparent rounded-full opacity-30 dark:opacity-5"></div>
				<div class="absolute top-[-75%] right-[-25%] w-[65%] h-full bg-gradient-to-b from-purple-300 via-blue-300 to-transparent rounded-full opacity-30 dark:opacity-5"></div>
				<div class="absolute top-[-85%] left-[-30%] w-[85%] h-full bg-gradient-to-b from-indigo-300 via-orange-300 to-transparent rounded-full opacity-60 dark:opacity-5"></div>
				<div class="absolute top-[-85%] right-[-30%] w-[85%] h-full bg-gradient-to-b from-orange-300 via-indigo-300 to-transparent rounded-full opacity-60 dark:opacity-5"></div>
		
		</div>	
		
		<nav
			aria-label="Mobile navigation menu"
			class="text-lg absolute inset-0 flex flex-col items-center justify-center gap-y-4 text-center font-medium text-accent-two"
			id="nav-menu-mobile"
		>
			<!-- Menu links -->
			{
				menuLinks.map((link) => (
					<a
						aria-current={Astro.url.pathname === link.path ? "page" : false}
						class="underline-offset-2 hover:underline"
						data-astro-prefetch
						href={link.path}
					>
						{link.title}
					</a>
				))
			}
			{/* <a
				class="flex h-8 items-center rounded-lg bg-accent-base/5 px-4 text-accent-base underline-offset-2 hover:bg-accent-base/10"
				data-astro-prefetch
				href="/series/citrus-docs"
			>
				Docs
			</a> */}
		</nav>
	</div>
</div>

<script>
	document.addEventListener("DOMContentLoaded", () => {
		const toggleNavMenuMobileButton = document.getElementById("toggle-nav-menu-mobile");
		const openMenuIcon = document.getElementById("open-nav-menu-icon");
		const closeMenuIcon = document.getElementById("close-nav-menu-icon");
		const drawer = document.getElementById("drawer");

		// Check if elements exist
		if (!toggleNavMenuMobileButton || !openMenuIcon || !closeMenuIcon || !drawer) {
			console.error("One or more required elements are missing in the DOM.");
			return;
		}

		const drawerBody = document.getElementById("drawer-body");
		if (!drawerBody) {
			console.error("Drawer body element is missing in the DOM.");
			return;
		}

		toggleNavMenuMobileButton.addEventListener("click", () => {
			const isOpen = toggleNavMenuMobileButton.getAttribute("aria-expanded") === "true";

			if (isOpen) {
				// Close menu
				drawerBody.classList.add("opacity-0", "-translate-y-full");
				drawerBody.classList.remove("translate-y-0");

				// Remove after animation
				setTimeout(() => {
					drawer.classList.add("hidden");
				}, 300);

				// Change icons
				openMenuIcon.classList.add("scale-100", "opacity-100");
				closeMenuIcon.classList.add("scale-0", "opacity-0");
				closeMenuIcon.classList.remove("scale-100", "opacity-100");
			} else {
				// Show menu
				drawer.classList.remove("hidden");
				drawerBody.classList.add("translate-y-0");
				drawerBody.classList.remove("opacity-0", "-translate-y-full");

				// Change icons
				openMenuIcon.classList.add("scale-0", "opacity-0");
				closeMenuIcon.classList.add("scale-100", "opacity-100");
				openMenuIcon.classList.remove("scale-100", "opacity-100");
			}

			// Update button state
			toggleNavMenuMobileButton.setAttribute("aria-expanded", (!isOpen).toString());
		});
	});
</script>



